<section class="container mt-3">
    <div class="row">
        <div class="col-md-6" id="projectList">
            <ul class="custom-list">
                
            </ul>
            <button type="button" class="btn btn-primary mt-2 custom-button" id="addProjectBtn">+Adicionar Projeto</button>
            <div id="projectForm" class="mt-3" style="display: none;">
                <input type="text" class="form-control-2 mb-2" id="nomeProjeto" placeholder="Nome do projeto">
                <button type="button" class="btn btn-danger mt-2 custom-button" id="cancelProjectBtn">Cancelar</button>
                <button type="button" class="btn btn-success mt-2 mr-2 custom-button" id="saveProjectBtn">Salvar Projeto</button>
            </div>
        </div>
    </div>
</section>

<script>
    $(document).ready(function() {
        // Função para carregar e exibir os projetos
        function carregarProjetos() {
            $.ajax({
                type: "GET",
                url: "/listar_projetos",
                success: function(response) {
                    if (response.projetos && response.projetos.length > 0) {
                        // Limpar a lista de projetos
                        $(".custom-list").empty();

                        // Adicionar cada projeto à lista
                        response.projetos.forEach(function(projeto) {
                            $(".custom-list").append(`<li><a href="#" class="custom-link" data-projeto="${projeto.nome}">${projeto.nome}</a></li>`);
                        });
                    }
                },
                error: function(err) {
                    console.error("Erro ao carregar projetos:", err);
                }
            });
        }

        // Chamar a função para carregar os projetos quando a página carregar
        carregarProjetos();

        // Ao clicar em um projeto na lista
        $(".custom-list").on("click", ".custom-link", function(e) {
            e.preventDefault();
            var projetoSelecionado = $(this).data("projeto");

            // Enviar solicitação AJAX para atualizar o projeto selecionado no banco de dados
            $.ajax({
                type: "POST",
                url: "/atualizar_projeto_selecionado",
                data: { projetoSelecionado: projetoSelecionado },
                success: function(response) {
                    // Verificar se a resposta contém uma mensagem de sucesso
                    if (response.mensagem) {
                        console.log(response.mensagem);
                        // Atualizar a sessão do usuário com o novo projeto selecionado
                        window.location.reload();
                    } else {
                        console.log("Erro ao atualizar projeto selecionado");
                    }
                },
                error: function(err) {
                    console.error("Erro ao atualizar projeto selecionado:", err);
                }
            });
        });

        // Ao clicar no botão +Adicionar Projeto
        $("#addProjectBtn").click(function() {
            // Mostra o formulário do projeto
            $("#projectForm").slideDown();
        });

        // Ao clicar no botão Cancelar
        $("#cancelProjectBtn").click(function() {
            // Oculta o formulário do projeto
            $("#projectForm").slideUp();
        });

        // Ao clicar no botão Salvar Projeto
        $("#saveProjectBtn").click(function() {
            // Obter o valor do campo de entrada do nome do projeto
            var nomeProjeto = $("#nomeProjeto").val();

            // Enviar a solicitação AJAX
            $.ajax({
                type: "POST",
                url: "/adicionar_projeto",
                data: { nome: nomeProjeto },
                success: function(response) {
                    // Verificar se a resposta contém uma mensagem de sucesso
                    if (response.mensagem) {
                        // Exibir um alerta de sucesso
                        alert(response.mensagem);
                        location.reload();
                    } else {
                        // Se não houver mensagem de sucesso, pode ser um erro
                        alert("Erro ao adicionar projeto");
                    }
                    $("#projectForm").slideUp();
                },
                error: function(err) {
                    console.error(err);
                    alert("Erro ao adicionar projeto");
                }
            });
        });
    });
</script>
